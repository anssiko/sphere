<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Battery Status API tests</title>
    <script>
    function success(msg) {
        document.getElementById('success') .innerHTML += '<div>' + msg + '</div>';
    }

    function fail(msg) {
        document.getElementById('error') .innerHTML += '<div>' + msg + '</div>';
    }
    
    function log(msg) {
        document.getElementById('log') .innerHTML += '<div>' + msg + '</div>';
    }
    
    var test = {};
    
    test.battery = {
        level: function () {
            try {
                // FIXME: Qt Simulator does not like typeof checking
                //if (typeof navigator.battery.level === 'number') {
                    success('navigator.battery.level: ' + navigator.battery.level);
                //}
            } catch (ex) {
                fail('navigator.battery.level: ' + ex);
            }
        },
        charging: function () {
            try {
                // FIXME: Qt Simulator does not like typeof checking
                //if (typeof navigator.battery.charging === 'boolean') {
                    success('navigator.battery.charging: ' + navigator.battery.charging);
                //}
            } catch (ex) {
                fail('navigator.battery.charging: ' + ex);
            }
        },
        onlevelchange: function (msg) {
            // FIXME: navigator.battery is uninitialized onload
            if (typeof navigator.battery === 'object') {
                try {
                    navigator.battery.onlevelchange = function () {
                        success(msg || '' + 'onlevelchange, level: ' + navigator.battery.level);
                    }
                } catch (ex) {
                    fail('onlevelchange: ' + ex);
                }
            }
        },
        onchargingchange: function (msg) {
            // FIXME: navigator.battery is uninitialized onload
            if (typeof navigator.battery === 'object') {
                try {
                    navigator.battery.onchargingchange = function () {
                        success('onchargingchange, charging: ' + navigator.battery.charging);
                    }
                } catch (ex) {
                    fail('onchargingchange: ' + ex);
                }
            }
        },
        addEventListenerLevelChange: function () {
            try {
                navigator.battery.addEventListener('levelchange', function () {
                    success('addEventListener(\'levelchange\')');
                });
            } catch (ex) {
                fail('addEventListener(\'levelchange\'): ' + ex);
            }
        },
        removeEventListenerLevelChange: function () {
            try {
                navigator.battery.removeEventListener('levelchange', function () {
                    success('removeEventListener(\'levelchange\')');
                });
            } catch (ex) {
                fail('removeEventListener(\'levelchange\'): ' + ex);
            }
        }
        ,
        addEventListenerChargingChange: function () {
            try {
                navigator.battery.addEventListener('chargingchange', function () {
                    success('addEventListener(\'chargingchange\')');
                });
            } catch (ex) {
                fail('addEventListener(\'chargingchange\'): ' + ex);
            }
        },
        removeEventListenerChargingChange: function () {
            try {
                navigator.battery.removeEventListener('chargingchange', function () {
                    success('removeEventListener(\'chargingchange\')');
                });
            } catch (ex) {
                fail('removeEventListener(\'chargingchange\'): ' + ex);
            }
        }
    };
    
    window.onload = function () {
        test.battery.onlevelchange('onload');
        test.battery.onchargingchange('onload');
    }
    
    </script>
  </head>
  <body>
    <h1>Battery Status API tests</h1>
    <h3>TODO: migrate tests to harness.js</h3>
    <button onclick="test.battery.level()">test.battery.level()</button>
    <button onclick="test.battery.charging()">test.battery.charging()</button>
    <button onclick="test.battery.onlevelchange()">register onlevelchange handler</button>
    <button onclick="test.battery.onchargingChange()">register onchargingchange handler</button>
    <button onclick="test.battery.addEventListenerLevelChange()">addEventListener('levelchange')</button>
    <button onclick="test.battery.removeEventListenerLevelChange()">removeEventListener('levelchange')</button>
    <button onclick="test.battery.addEventListenerChargingChange()">addEventListener('chargingchange')</button>
    <button onclick="test.battery.removeEventListenerChargingChange()">removeEventListener('chargingchange')</button>
    <h3>Success:</h3>
    <div id="success"></div>
    <h3>Fail:</h3>
    <div id="error"></div>
    <h3>Log:</h3>
    <div id="log"></div>
  </body>
</html>